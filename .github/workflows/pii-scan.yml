name: PII Data Scan Pipeline

on:
  push:
    branches: [ none ]
  pull_request:
    branches: [ none ]
  workflow_dispatch:
  
jobs:
  pii-scan:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Setup Java
      uses: actions/setup-java@v3
      with:
        java-version: '11'
        distribution: 'temurin'
        
    - name: Setup Gosu Runtime
      shell: cmd
      run: |
        echo Setting up Gosu runtime...
        dir gosu.bat
        dir gosu\gosu.jar
        
    - name: Build Gosu Applications
      shell: cmd
      run: |
        echo Building Gosu applications...
        if exist dist rmdir /s /q dist
        build-app.bat
        
    - name: Run PII Data Scan (using gosu.bat)
      shell: cmd
      run: |
        echo Running PII Scanner with gosu.bat...
        gosu.bat PIIScanner.gs

    # Alternative: Run directly with java if gosu.bat is not configured
    # - name: Run PII Data Scan (using java)
    #   shell: cmd
    #   run: |
    #     echo Running PII Scanner with java...
    #     java -cp "gosu\gosu.jar;." gw.lang.Gosu PIIScanner.gs
        
    - name: Upload PII Scan Report
      uses: actions/upload-artifact@v4
      with:
        name: pii-scan-report
        path: pii-scan-report.log
        
    - name: Display Report Summary
      shell: cmd
      run: |
        echo PII Scan Report Summary:
        type pii-scan-report.log
